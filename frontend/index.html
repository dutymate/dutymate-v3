<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0" />
    <meta name="google" content="notranslate" />
    <title>ë“€í‹°ë©”ì´íŠ¸</title>

    <!-- ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€ ë° ë¦¬ë‹¤ì´ë ‰íŠ¸ -->
    <script>
      (function(d, ua, l) {
        // ì¸ì•± ë¸Œë¼ìš°ì € ì²˜ë¦¬ê°€ ì´ë¯¸ ì‹œë„ëëŠ”ì§€ í™•ì¸ (ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©)
        const inappHandled = sessionStorage.getItem('inappHandled');
        const currentTime = new Date().getTime();
        const lastHandleTime = parseInt(sessionStorage.getItem('lastHandleTime') || '0');
        
        // ë§ˆì§€ë§‰ ì²˜ë¦¬ í›„ 10ì´ˆê°€ ì§€ë‚¬ëŠ”ì§€ í™•ì¸ (ë°˜ë³µ ì²˜ë¦¬ ë°©ì§€)
        const timeThreshold = 10 * 1000; // 10ì´ˆ
        const shouldHandle = !inappHandled || (currentTime - lastHandleTime) > timeThreshold;

        // í”Œë«í¼ê³¼ ì•± ê°ì§€
        const isAndroid = /android/i.test(ua);
        const isIOS = /i(?:phone|pad)/i.test(ua);
        const isKakao = /(?:iphone|ipad|android).* kakaotalk/i.test(ua);
        const isInstagram = /instagram/i.test(ua);

        // ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage() {
          const existingBg = d.querySelector('.__inappBg__');
          if (existingBg) {
            return;
          }

          // ì¹´ì¹´ì˜¤í†¡ì€ ë©”ì‹œì§€ í‘œì‹œí•˜ì§€ ì•ŠìŒ
          if (isKakao) {
            return;
          }
          
          const bg = d.createElement('div'), box = d.createElement('div'), style = d.createElement('style');
          bg.className = '__inappBg__';
          box.className = '__inappBox__';
          
          // í”Œë«í¼ê³¼ ì•±ì— ë”°ë¥¸ ë©”ì‹œì§€ ì„¤ì •
          const menuIcon = 'â‹®';
          const menuText = isAndroid ? '"ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°"' : '"ì™¸ë¶€ ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°"';
          const menuIconStyle = isInstagram ? 'transform: rotate(90deg);' : 'transform: none;';
          
          // ë©”ì‹œì§€ ë°•ìŠ¤
          box.innerHTML = `
            <div class="__inappHeader__">
              <div class="__inappIcon__">âœ¨</div>
              <h3 class="__inappTitle__">ë“€í‹°ë©”ì´íŠ¸ê°€ ê¸°ë‹¤ë¦¬ê³  ìˆì–´ìš”!</h3>
            </div>
            <div class="__inappContent__">
              <p>ì•„ì‰½ê²Œë„ ì¸ì•± ë¸Œë¼ìš°ì €ì—ì„œëŠ”<br>ëª¨ë“  ê¸°ëŠ¥ì„ ì¦ê¸°ê¸° ì–´ë ¤ì›Œìš” ğŸ˜¢</p>
              <div class="__inappGuide__">
                <p class="__inappHighlightBox__">
                  ì˜¤ë¥¸ìª½ ìƒë‹¨ì˜ <span class="__inappHilite__ __inappMenuIcon__">${menuIcon}</span> ë©”ë‰´ë¥¼ í´ë¦­!<br>
                  <span class="__inappHilite__">${menuText}</span>ë¥¼ í´ë¦­í•´ì£¼ì„¸ìš”!
                </p>
                <p class="__inappMenuGuide__">
                  <span class="__inappHilite__">ì™¸ë¶€ ë¸Œë¼ìš°ì €</span>ë¥¼ í†µí•´<br>
                  <span class="__inappHilite__">ë” ë¹ ë¥´ê³  í¸í•˜ê²Œ</span> ì´ìš©í•  ìˆ˜ ìˆì–´ìš”!
                </p>
                <div class="__inappArrow__">ğŸ‘†</div>
              </div>
            </div>
          `;
          
          // CSS
          style.innerHTML = `
            .__inappBg__ { 
              position: fixed; 
              top: 0; 
              left: 0; 
              width: 100vw; 
              height: 100vh; 
              z-index: 1000; 
              background: rgba(0, 0, 0, 0.6); 
            } 
            
            .__inappBox__ { 
              position: fixed;
              width: 100vw;
              height: 100vh;
              top: 0;
              left: 0;
              z-index: 1001;
              background: #FFFFFF; 
              color: #4D4D4D; 
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              animation: __inappSlideUp__ 0.3s ease-out;
            }
            
            @keyframes __inappSlideUp__ {
              from { opacity: 0; }
              to { opacity: 1; }
            }
            
            .__inappHeader__ {
              padding: 20px 20px 0;
              text-align: center;
            }
            
            .__inappIcon__ {
              font-size: 32px;
              margin-bottom: 8px;
            }
            
            .__inappTitle__ {
              font-size: 20px;
              font-weight: 600;
              color: #4D4D4D;
              margin: 0 0 16px;
            }
            
            .__inappContent__ {
              padding: 0 20px 20px;
              text-align: center;
              font-size: 16px;
              line-height: 1.6;
            }
            
            .__inappGuide__ {
              margin-top: 24px;
              font-size: 15px;
              color: #666;
              position: relative;
            }

            .__inappHighlightBox__ {
              background: #FEF6F2;
              border-radius: 12px;
              padding: 16px;
              margin-bottom: 16px;
              font-size: 16px;
              line-height: 1.6;
            }
            
            .__inappHilite__ { 
              font-weight: 600; 
              color: #F5A281;
            }

            .__inappMenuIcon__ {
              font-size: 20px;
              font-weight: 900;
              background: #F5A281;
              color: white;
              padding: 4px 8px;
              border-radius: 6px;
              display: inline-block;
              line-height: 1;
              vertical-align: middle;
              text-shadow: 0 0 1px rgba(0, 0, 0, 0.2);
              letter-spacing: -1px;
              font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
              ${menuIconStyle}
            }

            .__inappMenuGuide__ {
              font-size: 14px;
              color: #666;
            }

            .__inappArrow__ {
              position: fixed;
              top: 20px;
              right: 10px;
              font-size: 40px;
              animation: __inappArrowBounce__ 1.5s infinite;
            }

            @keyframes __inappArrowBounce__ {
              0%, 100% { transform: translateY(0); }
              50% { transform: translateY(-10px); }
            }
          `;
          
          d.body.appendChild(bg);
          d.body.appendChild(box);
          d.body.appendChild(style);
          
          // ë°°ê²½ í´ë¦­ìœ¼ë¡œ ë‹«ê¸° (3ë²ˆ í´ë¦­)
          let click = 3;
          bg.addEventListener('click', () => {
            click--;
            if(!click) {
              if (d.body.contains(bg)) d.body.removeChild(bg);
              if (d.body.contains(box)) d.body.removeChild(box);
              if (d.body.contains(style)) d.body.removeChild(style);
            }
          });
        }
        
        // ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì € ê°ì§€
        if (isKakao && shouldHandle) {
          // ê¸°ì¡´ ì¹´ì¹´ì˜¤í†¡ ì²˜ë¦¬ ë°©ì‹ ìœ ì§€
          sessionStorage.setItem('inappHandled', 'true');
          sessionStorage.setItem('lastHandleTime', currentTime.toString());
          
          // ë”œë ˆì´ ì¶”ê°€ - ì—°ì† ë¦¬ë””ë ‰ì…˜ ë°©ì§€
          setTimeout(() => {
            // URLì— ë¶ˆí•„ìš”í•œ íŒŒë¼ë¯¸í„°ê°€ ìˆë‹¤ë©´ ì œê±°
            let cleanUrl = l.href;
            try {
              const url = new URL(l.href);
              url.searchParams.delete('inapp_handled');
              cleanUrl = url.toString();
            } catch (e) {
              console.error("URL ì²˜ë¦¬ ì˜¤ë¥˜:", e);
            }
            
            location.href = 'kakaotalk://web/openExternal?url=' + encodeURIComponent(cleanUrl);
          }, 100);
          return;
        }
        
        // ë‹¤ë¥¸ ì¸ì•± ë¸Œë¼ìš°ì € ì²˜ë¦¬
        function setLink(url) {
          // ì´ë¯¸ ì²˜ë¦¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
          if (!shouldHandle) {
            // ì´ë¯¸ ì²˜ë¦¬ëœ ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€ë§Œ í‘œì‹œ
            setTimeout(() => {
              if (!d.querySelector('.__inappBg__')) {
                showMessage();
              }
            }, 1000);
            return;
          }
          
          // ì²˜ë¦¬ ìƒíƒœ ì €ì¥
          sessionStorage.setItem('inappHandled', 'true');
          sessionStorage.setItem('lastHandleTime', currentTime.toString());
          
          // ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ
          setTimeout(showMessage, 1000);
          
          // í´ë¦° URL ë§Œë“¤ê¸° - ì¤‘ë³µ íŒŒë¼ë¯¸í„° ë°©ì§€
          let cleanUrl = url;
          try {
            const urlObj = new URL(url);
            urlObj.searchParams.delete('inapp_handled');
            // ì²˜ë¦¬ í”ì  ì¶”ê°€
            urlObj.searchParams.set('inapp_handled', 'true');
            cleanUrl = urlObj.toString();
          } catch (e) {
            console.error("URL ì²˜ë¦¬ ì˜¤ë¥˜:", e);
          }
          
          // URL ë³€ê²½ ì „ ì•½ê°„ì˜ ì§€ì—° ì¶”ê°€
          setTimeout(() => {
            window.location.href = cleanUrl;
          }, 300);
        }

        if(/(?:iphone|ipad|android).* line\//i.test(ua)) {
          setLink(l.href + (/\?/.test(l.href) ? '&' : '?') + 'openExternalBrowser=1');
        } else if(/inapp|naver|snapchat|wirtschaftswoche|thunderbird|instagram|everytimeapp|whatsapp|electron|wadiz|aliapp|zumapp|kakaostory|band|twitter|daumapps|daumdevice\/mobile|fb_iab|fb4a|fban|fbios|fbss|trill/i.test(ua)) {
          if (isAndroid) {
            setLink(l.href.replace(/^(https?):\/\/(.*)$/, 'intent://$2#Intent;scheme=$1;package=com.android.chrome;end'));
          } else if (isIOS) {
            // ì´ë¯¸ ì²˜ë¦¬ëœ ê²½ìš° ë©”ì‹œì§€ë§Œ í‘œì‹œ
            if (!shouldHandle) {
              setTimeout(() => {
                if (!d.querySelector('.__inappBg__')) {
                  showMessage();
                }
              }, 1000);
              return;
            }
            // ìƒˆ ì²˜ë¦¬
            setLink(l.href.replace(/^http/, 'googlechrome')); // ì•„ì´í°ì— í¬ë¡¬ì´ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ë©´ í¬ë¡¬ì´ë¼ë„ ì—´ê¸°.
          }
        }
      })(document, navigator.userAgent, location);
    </script>

    <!-- HTML Meta Tags -->
    <meta name="description" content="ê°„í˜¸ì‚¬ë¥¼ ìœ„í•œ ê·¼ë¬´í‘œ ìë™ ìƒì„± ì„œë¹„ìŠ¤">

    <!-- Facebook Meta Tags -->
    <meta property="og:url" content="https://dutymate.net">
    <meta property="og:type" content="website">
    <meta property="og:title" content="ë“€í‹°ë©”ì´íŠ¸">
    <meta property="og:description" content="ê°„í˜¸ì‚¬ë¥¼ ìœ„í•œ ê·¼ë¬´í‘œ ìë™ ìƒì„± ì„œë¹„ìŠ¤">
    <meta property="og:image" content="https://dutymate-bucket-prod.s3.ap-northeast-2.amazonaws.com/images/og-rectangle.png">

    <!-- Twitter Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta property="twitter:domain" content="dutymate.net">
    <meta property="twitter:url" content="https://dutymate.net">
    <meta name="twitter:title" content="ë“€í‹°ë©”ì´íŠ¸">
    <meta name="twitter:description" content="ê°„í˜¸ì‚¬ë¥¼ ìœ„í•œ ê·¼ë¬´í‘œ ìë™ ìƒì„± ì„œë¹„ìŠ¤">
    <meta name="twitter:image" content="https://dutymate-bucket-prod.s3.ap-northeast-2.amazonaws.com/images/og-rectangle.png">

    
    <!-- Meta Tags Generated via https://www.opengraph.xyz -->

    <!-- Google Tag Manager (GTM) ì„¤ì • -->
    <!-- GTMì€ ì›¹ì‚¬ì´íŠ¸ì˜ íƒœê·¸ë¥¼ ê´€ë¦¬í•˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤. 
         ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” GTMì„ ì›¹ì‚¬ì´íŠ¸ì— ì„¤ì¹˜í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.
         GTM-M9XTN3B3ëŠ” ì—¬ëŸ¬ë¶„ì˜ GTM ì»¨í…Œì´ë„ˆ IDì…ë‹ˆë‹¤. -->
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-M9XTN3B3');
    </script>
    <!-- End Google Tag Manager -->

    <!-- Google Analytics 4 (GA4) ì„¤ì • -->
    <!-- GA4ëŠ” êµ¬ê¸€ì˜ ì›¹ ë¶„ì„ ë„êµ¬ì…ë‹ˆë‹¤. 
         ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” GA4ë¥¼ ì›¹ì‚¬ì´íŠ¸ì— ì„¤ì¹˜í•˜ëŠ” ì½”ë“œì…ë‹ˆë‹¤.
         G-ZCF7VCE51WëŠ” ì—¬ëŸ¬ë¶„ì˜ GA4 ì¸¡ì • IDì…ë‹ˆë‹¤. -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZCF7VCE51W"></script>
    <script>
      // dataLayerëŠ” GTMê³¼ GA4ê°€ ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” ê³µê°„ì…ë‹ˆë‹¤.
      window.dataLayer = window.dataLayer || [];
      // gtag í•¨ìˆ˜ëŠ” GA4ì— ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
      function gtag(){dataLayer.push(arguments);}
      // GA4 ì´ˆê¸°í™”
      gtag('js', new Date());
      // GA4 ì„¤ì • (ì¸¡ì • ID ì„¤ì •)
      gtag('config', 'G-ZCF7VCE51W');
    </script>
  </head>
  <body>
    <div id="root"></div>
    <!-- Google Tag Manager (noscript) -->
    <!-- ì´ ë¶€ë¶„ì€ JavaScriptê°€ ë¹„í™œì„±í™”ëœ ë¸Œë¼ìš°ì €ì—ì„œë„ GTMì´ ì‘ë™í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë°±ì—… ì½”ë“œì…ë‹ˆë‹¤. -->
    <noscript>
      <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M9XTN3B3"
              height="0" width="0" style="display:none;visibility:hidden">
      </iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
